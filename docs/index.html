<!-- Dynamic Metrics -->
<h2>Dynamic Backtest Metrics</h2>
<div id="metrics"></div>

<!-- Dynamic Holdings Table -->
<h2>Portfolio Allocation & News</h2>
<table id="holdingsTable"></table>

<!-- Dynamic Performance Table -->
<h2>Multi-Timeframe Performance (%)</h2>
<table id="performanceTable"></table>

<!-- Dynamic Pie Chart -->
<h2>Dynamic Portfolio Weights</h2>
<canvas id="weightsChart" width="400" height="400"></canvas>

<script>
fetch('portfolio.json')
  .then(res => res.json())
  .then(data => {
    // Metrics
    document.getElementById('metrics').innerHTML = `
      <p><strong>Total Return (3Y):</strong> ${data.metrics.total_return_3y}</p>
      <p><strong>CAGR:</strong> ${data.metrics.cagr}</p>
      <p><strong>Max Drawdown:</strong> ${data.metrics.max_drawdown}</p>
      <p><strong>Sharpe Ratio:</strong> ${data.metrics.sharpe_ratio}</p>
      <p><strong>Last Updated:</strong> ${new Date(data.last_updated).toLocaleString()}</p>
    `;

    // Holdings Table
    let holdingsHTML = "<tr><th>Ticker</th><th>Name</th><th>Weight</th><th>Quantity</th><th>Initial Price</th><th>Last Price</th><th>News</th></tr>";
    data.holdings.forEach(h => {
      holdingsHTML += `<tr>
        <td>${h.ticker}</td>
        <td>${h.name}</td>
        <td>${h.weight}</td>
        <td>${h.quantity}</td>
        <td>${h.initial_price}</td>
        <td>${h.last_price}</td>
        <td>${h.news}</td>
      </tr>`;
    });
    document.getElementById('holdingsTable').innerHTML = holdingsHTML;

    // Performance Table
    let perfHTML = "<tr><th>Period</th><th>Portfolio</th><th>QQQ</th><th>SPY</th><th>ESGU</th></tr>";
    for (const [period, values] of Object.entries(data.performance)) {
      perfHTML += `<tr>
        <td>${period}</td>
        <td>${values.Portfolio}</td>
        <td>${values.QQQ}</td>
        <td>${values.SPY}</td>
        <td>${values.ESGU}</td>
      </tr>`;
    }
    document.getElementById('performanceTable').innerHTML = perfHTML;

    // Pie Chart
    const ctx = document.getElementById('weightsChart').getContext('2d');
    new Chart(ctx, {
      type: 'pie',
      data: {
        labels: Object.keys(data.portfolio_weights),
        datasets: [{
          data: Object.values(data.portfolio_weights),
          borderWidth: 1
        }]
      },
      options: { plugins: { legend: { position: 'bottom' } } }
    });
  });
</script>
